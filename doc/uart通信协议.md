# 文档目标

列举可能的通信方式方法，以便UART上位机择优选择


# 现状

- 通信数据发送较快，有过多重复数据（数据处理/BLE发送不及时的话，可能会淹没buffer破坏数据）
- 通信数据格式不统一（长度不固定），例如，心率有时是3位十进制，有时是2位十进制




# 二进制通信方式

## 协议格式：

| 帧头    | 指令  | 数据长度 | 数据 |
| --------- | ----- | -------- | -----  |
| 0xFF 0x55 | 1字节 | 1字节    | N字节 |



## 指令表：

| 指令 | 功能 |
|---|---|
| 0x00 | 呼吸速率 |
| 0x01 | 心率 |
| 0x2 ~ 0xff | 预留 |



## 指令说明

####  0x00 呼吸速率 

说明： sensor上报当前呼吸速率，数据长度1bytes, 例如当前呼吸速率155(0x9B)

- 小数点后数据去除

| 帧头      | 指令 | 数据长度 | 数据              |
| --------- | ---- | -------- | ----------------- |
| 0xFF 0x55 | 0x00 | 1        | 实际呼吸速率 0x9B |



####  0x01 心率

说明： sensor上报当前心率，数据长度1bytes, 例如当前心率155(0x9B)

- 小数点后数据去除

| 帧头      | 指令 | 数据长度 | 数据              |
| --------- | ---- | -------- | ----------------- |
| 0xFF 0x55 | 0x01 | 1        | 实际呼吸速率 0x9B |



# AT指令方式

说明，用ASCII字符串方式，可以简单实现AT指令; 可以兼顾串口打印和通信简洁。

- 有效数据需要保持3位十进制数
- 小数点后数据去除

| 帧头 | 间隔符 | 指令代码 | 间隔符 | 数据字符串                                   | 换行 |
| ---- | ------ | -------- | ------ | -------------------------------------------- | ---- |
| 'AT' | '+'    | 'BR'     | =      | ‘086’（需要保持3位十进制，不足3位，需要补0） | \r\n |
| 'AT' | '+'    | 'HE'     | =      | '155'（需要保持3位十进制，不足3位，需要补0） | \r\n |





# BLE 部分约定（待定义）

- 广播名称？
- 广播间隔等其他时间参数？
- service/characteristic UUID？（暂时基于simple peripheral 服务来修改）
- 通信方式，notify ？read？ or both？